!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.MHTML={})}(this,function(e){"use strict";function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createTextNode(""),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.createTextNode("");return this.childNodes=[],this.firstChild=null,this.lastChild=null,this.startNode=e,this.stopNode=t,e&&t?e.parentNode!==t.parentNode?this:(this.update(),this):this}t.prototype.appendChild=function(e){this.stopNode.parentNode.insertBefore(e,this.stopNode),this.update()},t.prototype.removeChild=function(e){this.stopNode.parentNode.removeChild(e),this.update()},t.prototype.replaceChild=function(e,t){t.parentNode.replaceChild(e,t),this.update()},t.prototype.extractContents=function(){var e=document.createDocumentFragment();return e.appendChild(this.startNode),this.childNodes.reduce(function(e,t){return e.appendChild(t),e},e),e.appendChild(this.stopNode),e},t.prototype.update=function(){this.childNodes=[];for(var e=this.startNode.nextSibling;e&&e!==this.stopNode;e=e.nextSibling)this.childNodes.push(e);this.firstChild=this.childNodes[0],this.lastChild=this.childNodes[this.childNodes.length-1]};var n,r=1,o=3,a=8,i=document.body.namespaceURI,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function c(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function s(e,t){return e.nodeType===t.nodeType&&(e.tagName&&t.tagName&&e.tagName.toLowerCase()===t.tagName.toLowerCase())}function d(e){return void 0!==e}function f(e){return!!e&&("object"===(void 0===e?"undefined":u(e))||l(e))&&l(e.then)}function l(e){return"function"==typeof e}function p(e){return e&&"object"===(void 0===e?"undefined":u(e))&&e.constructor===Object}function h(e){return(void 0===e?"undefined":u(e))===u(!0)}function v(e){return"string"==typeof e}function m(e){return e.replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g,"\\$&")}var y=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N={},C=new Map,b=new Map,x=new DOMParser,w="{modulor_html_chunk_"+ +new Date+":",D="}",T=/<([/]?)([^ />]+)((?:\s+[\w}{:-]+(?:([\s])*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)[ ]*>/gim,A=/([-A-Za-z0-9_}{:]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/gim,j=["table","tr","td","style"],k="modulor-dynamic-tag-"+ +new Date,S="modulor-chunk-"+ +new Date,O="modulor-data-attributes-"+ +new Date,E=new RegExp(G(),"i"),F=new RegExp(G(!0),"ig"),I=new RegExp("^"+G(!0)+"$"),R="preventChildRendering",L="preventAttributeSet",M="function",U="array",$="element",_="promise",P="undefined",J="text";function V(e){return l(e)?M:e instanceof Array?U:e instanceof Node?$:f(e)?_:d(e)?J:P}function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];return n?t[n[2]]:e.replace(F,function(e,n,r){var o=t[r];return d(o)?o:""})}function B(e,t){var n=t.name,r=t.value;if(f(r))r.then(function(t){return B(e,{name:n,value:t})});else if("style"!==n)if(l(n))n(e,r);else{if(n in e){h(e[n])&&!1!==r&&e.setAttribute(n,r);try{return void(e[n]=r)}catch(e){}}e.setAttribute(n,r)}else p(r)?Object.assign(e.style,r):e.setAttribute(n,r)}function H(e,t,n){var r=new Map;return[function(e,t){r.set(e,{value:t,updated:(r.get(e)||{}).value!==t,keep:!0})},function(){var o={},a=!1;return r.forEach(function(i,u){var c=i.updated,s=i.value;if(!i.keep)return r.delete(u),a=!0,!n&&t(u,s);c&&(a=!0,!n&&e(u,s)),v(u)&&(o[u]=s),r.set(u,{value:s,keep:!1})}),[a,o]}]}function Z(e){return function e(t){var n={nodeType:t.nodeType,namespaceURI:t.namespaceURI,textContent:t.textContent,attributes:[],childNodes:[]},r=n.childNodes,i=t.getAttribute(O),u=E.exec(i),c=i?JSON.parse(i).map(function(e){var t=e.name,n=e.value,r=void 0===n||n;return{name:t,value:r,matchName:I.exec(t),matchValue:I.exec(r),nameIsDynamic:E.test(t),valueIsDynamic:E.test(r)}}):[];n.attributes=u?[function(e){var t=e[L],n=H(function(t,n){return B(e,{name:t,value:n})},function(t){e.removeAttribute(t),h(e[t])&&(e[t]=!1)},t),r=y(n,2),o=r[0],a=r[1],i=H(function t(n){f(n)?n.then(t):n&&e.classList.add(n)},function t(n){f(n)?n.then(t):n&&e.classList.remove(n)},t),u=y(i,2),s=u[0],d=u[1];return function(e){var t={},n=!1;for(var r in c){var i=c[r],u=i.name,f=i.value,l=i.matchName,h=i.matchValue,m=i.nameIsDynamic,g=i.valueIsDynamic,N=m?z(u,e,l):u;if("class"!==N){var C=g?z(f,e,h):f;if(N)if(p(N))for(var b in N)o(b,N[b]);else o(N,C)}else{var x=f.split(" ");for(var w in x){var D=x[w],T=z(D,e,D.match(I));(v(T)?T.split(" "):[].concat(T||[])).forEach(s)}var A=d(),j=y(A,2),k=j[0],S=j[1];n=n||k,t.className=Object.keys(S).join(" ")}}var O=a(),E=y(O,2),F=E[0],R=E[1];return[Object.assign(t,R),n||F]}}]:c;for(var s=t.childNodes||[],d=function(t){var n=s[t];return n.nodeType===o?(n.textContent.split(E).forEach(function(e){if(e){var t=I.exec(e);r.push(t?function(e){return function(n){return K(n[t[2]],e)}}:{nodeType:o,textContent:e})}}),"continue"):n.nodeType===a?(r.push(n.textContent.match(E)?function(e){var t=document.createComment(""),r=n.textContent;return e.appendChild(t),function(e){t.textContent=z(r,e)}}:{nodeType:a,textContent:n.textContent}),"continue"):void r.push(e(n))},l=0;l<s.length;l++)d(l);var m=t.tagName;if(m===k.toUpperCase()){var N=t.attributes[S].value,C=N.match(I);if(N.match(E))return function(e){var t=void 0;return function(r,o){var a=z(N,r,C),i=z(N,o,C);if(t&&a===i)return t(r);if(V(a)===M){var u,c=W((g(u={props:function(t){return K(a(t),e)},attributes:[]},L,!0),g(u,R,!0),u),n);return(0,y(c,1)[0])(r)}var s=X({childNodes:[Object.assign({},n,{tagName:a})]},e,{useDocFragment:!0}),d=y(s,2),f=d[0],l=d[1];f(r),l(),t=f}};n.tagName=N.toUpperCase()}else m&&(n.tagName=t.tagName.toUpperCase());return n}(x.parseFromString(e,"text/html").body)}function q(e){var t,n=(t=e,Array.isArray(t)?t:Array.from(t)),r=n[0];return n.slice(1).reduce(function(e,t,n){var r=""+w+n+D;return e.concat(r).concat(t)},r)}function G(e){var t=(e?"(":"")+"\\d+"+(e?")":"");return"("+m(w)+t+m(D)+")"}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.createDocumentFragment(),n=C.get(t)||{},r=V(e),o=n.lastChunk,a=n.lastRenderedChunkType,i=n.update;if(o===e)return t;if(r===_)return Q[_](t,e),t;if(a!==r)c(t);else if(i){var u=i(e);return l(u)&&(n.update=u),n.lastChunk=e,t}return C.set(t,{update:Q[r](t,e),lastRenderedChunkType:r,lastChunk:e}),t}var Q=(g(n={},U,function e(t,n){var r=X({childNodes:[].concat(n).map(function(e,t){return function(e){return function(n){return K(n[t],e)}}})},t,{useDocFragment:!0}),o=y(r,2),a=o[0],i=o[1];return a(n),i(),function(r){if(r.length!==n.length)return e(t,r);a(r)}}),g(n,P,c),g(n,J,function(e,t){var n=document.createTextNode(t);return e.appendChild(n),function(e){return n.textContent=e}}),g(n,$,function(e,t){return e.appendChild(t),function(t){e.childNodes.length>1&&e.childNodes.slice(1).forEach(function(t){return e.removeChild(t)}),e.replaceChild(t,e.childNodes[0])}}),g(n,_,function(e,t){t.then(function(t){e.update(),K(t,e)})}),g(n,M,function(e,t){var n=t(e);return function(t){n=t(e,n)}}),n);function W(e,t,n){for(var r=t.attributes,o=e.attributes,a=0;a<o.length;a++)e.removeAttribute(o[a].name);for(var i=[],u={},c=0;c<r.length;c++){var s=r[c];if(l(s))i.push(s(e));else{var d=s.name,f=s.value;B(e,{name:d,value:f}),u["class"===d?"className":d]=f}}if(e[R]&&i.push(function(e){return[{children:function(n,r){if(r)return r(e),r;var o=X(t,n,{useDocFragment:!0}),a=y(o,2),i=a[0],u=a[1];return i(e),u(),i}},!0]}),"props"in e){var p=l(e.props)?function(t,n){return e.props(t,n)}:function(t,n){return n&&(e.props=t)};if(i.length)return[function(e,t){var n=i.reduce(function(n,r){var o=y(n,2),a=o[0],i=o[1],u=r(e,t),c=y(u,2),s=c[0],d=c[1];return[Object.assign({},a,s),i||d]},[u,!1]),r=y(n,2),o=r[0],a=r[1];p(o,a)}];p(u,!0)}return i}function X(e,n){for(var u,c,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=[],p=d.useDocFragment?document.createDocumentFragment():n,h=e.childNodes,v=function(e){return e?function(t){return n.replaceChild(t,e)}:function(e){return p.appendChild(e)}},m=0,y=0;;m++){var g=h[m],N=n.childNodes[m+y];if(!g&&!N)break;if(g)if(N&&s(g,N))c=N,(o===(u=g).nodeType!==u.nodeType||u.textContent!==c.textContent)&&s(g,N)&&(f=f.concat(X(g,N)[0]).concat(W(N,g)));else{var C=v(N);if(l(g)){var x=b.get(N);if(!x){var w=(x=new t).startNode;C(x.extractContents()),b.set(w,x)}var D=g(x);D&&f.push(D),x.update(),y+=x.childNodes.length+1;continue}switch(g.nodeType){case o:C(document.createTextNode(g.textContent));break;case a:C(document.createComment(g.textContent));break;case r:var T=g.namespaceURI,A=g.tagName,j=T===i?document.createElement(A.toLowerCase()):document.createElementNS(T,A.toLowerCase());j[R]||(f=f.concat(X(g,j)[0])),f=f.concat(W(j,g)),C(j)}}else n.removeChild(N),m--}var k=[];return[function e(t){return f.forEach(function(e){return e(t,k)}),k=t,e},function(){return d.useDocFragment?n.appendChild(p):void 0}]}e.NodesRange=t,e.emptyNode=c,e.render=K,e.morph=X,e.html=function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!r.length)return this;var o=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(r.join(w+D)),a=N[o],i=void 0;if(d(a))i=a;else{var u=q(r);i=Z(u.replace(T,function(e,t,n,r,o,a){var i=(r=r.replace(/\/$/,function(){return a="/",""})).match(A);return r=i&&"!--"!==n?" "+O+"='"+JSON.stringify(i.reduce(function(e,t){var n=t.split("="),r=y(n,2),o=r[0],a=r[1];return e.concat({name:o,value:a?a.replace(/^['"]([^'"]*)['"]$/,"$1"):void 0})},[]))+"'":r,(~j.indexOf(n)||n.match(E))&&(r=" "+S+'="'+n.trim()+'"'+r,n=k),a?"<"+n+r+"></"+n+">":t?"</"+n+">":"<"+t+n+r+">"})),N[o]=i}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createDocumentFragment(),n=arguments[1];if(n&&n.templateId===o)return n(t);var r=X(i,e,{useDocFragment:!0}),a=y(r,2),u=a[0],c=a[1];return u(t),c(),u.templateId=o,u}},e.stopNode=function(){},Object.defineProperty(e,"__esModule",{value:!0})});
