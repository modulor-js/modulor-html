!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.MHTML={})}(this,function(e){"use strict";function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createTextNode(""),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.createTextNode("");return this.childNodes=[],this.firstChild=null,this.lastChild=null,this.startNode=e,this.stopNode=t,e&&t?e.parentNode!==t.parentNode?this:(this.update(),this):this}t.prototype.appendChild=function(e){this.stopNode.parentNode.insertBefore(e,this.stopNode),this.update()},t.prototype.removeChild=function(e){this.stopNode.parentNode.removeChild(e),this.update()},t.prototype.replaceChild=function(e,t){t.parentNode.replaceChild(e,t),this.update()},t.prototype.extractContents=function(){var e=document.createDocumentFragment();return e.appendChild(this.startNode),this.childNodes.reduce(function(e,t){return e.appendChild(t),e},e),e.appendChild(this.stopNode),e},t.prototype.update=function(){var e=this;this.childNodes=[];for(var t=this.startNode.nextSibling;t&&t!==this.stopNode;t=t.nextSibling)t.range&&(t.range.onUpdate=function(){return e.update()}),this.childNodes.push(t);this.firstChild=this.childNodes[0],this.lastChild=this.childNodes[this.childNodes.length-1],this.onUpdate&&this.onUpdate()},t.prototype.getByIndex=function(e){};var n=1,r=3,o=8,i=document.body.namespaceURI,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function c(e,t){return e.nodeType===t.nodeType&&(e.tagName&&t.tagName&&e.tagName.toLowerCase()===t.tagName.toLowerCase())}function d(e){return void 0!==e}function s(e){return!!e&&("object"===(void 0===e?"undefined":u(e))||f(e))&&f(e.then)}function f(e){return"function"==typeof e}function l(e){return e.replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g,"\\$&")}var h=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var p={},m=new Map,v=new Map,y=new DOMParser,g="{modulor_html_chunk_"+ +new Date+":",C="}",N="modulor_sanitize_node_"+ +new Date+":",b=new RegExp("<([ /])?("+["table","tr","td"].join("|")+")([ ][^]>)?","igm"),x=new RegExp(k(),"ig"),w=new RegExp(k(!0),"ig"),T=new RegExp("^"+k(!0)+"$");function j(e){return f(e)?"function":e instanceof Array?"array":e instanceof Node?"element":s(e)?"promise":d(e)?"text":"undefined"}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.replace(w,function(e,n,r){var o=t[r];return d(o)?o:""})}function E(e,t,n){if(s(n))n.then(function(n){return E(e,t,n)});else if("style"!==t)if(f(t))t(e,n);else{if(""!==n&&t in e)try{return void(e[t]=n)}catch(e){}e.setAttribute(t,n)}else!function(e){return e&&"object"===(void 0===e?"undefined":u(e))&&e.constructor===Object}(n)?e.setAttribute(t,n):Object.assign(e.style,n)}function D(e,t){if(d(e)&&""!==e){var n=j(e);return"promise"===n?e.then(function(e){return D(e,t)}):("array"===n?e:(""+e).split(" ")).forEach(function(e){return t(e)})}}function R(e){var t={nodeType:e.nodeType,namespaceURI:e.namespaceURI,textContent:e.textContent,attributes:[],childNodes:[]};e.tagName&&(t.tagName=e.tagName.toLowerCase().replace(N,"").toUpperCase());for(var n=e.attributes||[],i=function(e){var r=n[e],o=r.name,i=r.value,u=o.match(x),a=i.match(x),c=o.match(T),d=i.match(T);if("class"===o){var s=i.split(" ").reduce(function(e,t){return e[t.match(x)?0:1].push(t),e},[[],[]]),f=h(s,2),l=f[0],p=f[1];return t.attributes.push({name:o,value:p.join(" ")}),l.length&&t.attributes.push(function(e,t){return function(t,n){l.forEach(function(r){var o=r.match(T),i=o?t[o[2]]:A(r,t),u=o?n[o[2]]:A(r,n);u!==i&&(u&&D(u,function(t){return e.classList.remove(t)}),i&&D(i,function(t){return e.classList.add(t)}))})}}),"continue"}u||a?t.attributes.push(function(e){return function(t,n){var r=c?t[c[2]]:A(o,t),u=c?n[c[2]]:A(o,n),a=d?t[d[2]]:A(i,t),s=d?n[d[2]]:A(i,n);if((r!==u||a!==s)&&(r!==u&&e.removeAttribute(u),r))return E(e,r,a),function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},r,a)}}):t.attributes.push({name:o,value:i})},u=0;u<n.length;u++)i(u);for(var a=e.childNodes||[],c=function(e){var n=a[e];return n.nodeType===r?(n.textContent.split(x).filter(function(e){return!!e}).forEach(function(e){var n=e.match(T);if(n){var o=n[2];t.childNodes.push(function(e){return function(t){return F(t[o],e)}})}else t.childNodes.push({nodeType:r,textContent:e})}),"continue"):n.nodeType===o?(n.textContent.match(x)?t.childNodes.push(function(e){var t=document.createComment(""),r=n.textContent;return e.appendChild(t),function(e){t.textContent=A(r,e)}}):t.childNodes.push({nodeType:o,textContent:n.textContent}),"continue"):void t.childNodes.push(R(n))},d=0;d<a.length;d++)c(d);return t}function S(e){var t,n=(t=e,Array.isArray(t)?t:Array.from(t)),r=n[0];return n.slice(1).reduce(function(e,t,n){var r=""+g+n+C;return e.concat(r).concat(t)},r)}function k(e){var t=(e?"(":"")+"\\d+"+(e?")":"");return"("+l(g)+t+l(C)+")"}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.createDocumentFragment(),n=m.get(t)||{},r=j(e),o=n.lastChunk,i=n.lastRenderedChunkType,u=n.update;if(o===e)return t;if("promise"===r)return O.promise(t,e),t;if(i!==r)a(t);else if(u){var c=u(e);return f(c)&&(n.update=c),n.lastChunk=e,t}return m.set(t,{update:O[r](t,e),lastRenderedChunkType:r,lastChunk:e}),t}var O={array:function e(t,n){var r=U({childNodes:[].concat(n).map(function(e,t){return function(e){return function(n){return F(n[t],e)}}})},t,{useDocFragment:!0}),o=h(r,2),i=o[0],u=o[1];return i(n),u(),function(r){if(r.length!==n.length)return e(t,r);i(r)}},undefined:a,text:function(e,t){var n=document.createTextNode(t);return e.appendChild(n),function(e){return n.textContent=e}},element:function(e,t){return e.appendChild(t),function(t){e.childNodes.length>1&&e.childNodes.slice(1).forEach(function(t){return e.removeChild(t)}),e.replaceChild(t,e.childNodes[0])}},promise:function(e,t){t.then(function(t){e.update(),F(t,e)})},function:function(e,t){var n=t(e);return function(t){n=t(e,n)}}};function I(e,t){for(var n=t.attributes,r=e.attributes,o=0;o<r.length;o++)e.removeAttribute(r[o].name);for(var i=[],u={},a=0;a<n.length;a++){var c=n[a];if(f(c))i.push(c(e));else{var d=c.name,s=c.value;E(e,d,s),u[d]=s}}if("props"in e){if(i.length)return[function(t,n){var r=i.reduce(function(e,r){return Object.assign(e,r(t,n))},{});Object.keys(r).length&&(e.props=Object.assign(u,r))}];e.props=u}return i}function U(e,u){for(var a,d,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=[],h=s.useDocFragment?document.createDocumentFragment():u,p=e.childNodes,m=function(e){return e?function(t){return u.replaceChild(t,e)}:function(e){return h.appendChild(e)}},y=0,g=0;;y++){var C=p[y],N=u.childNodes[y+g];if(!C&&!N)break;if(C)if(N&&c(C,N))d=N,(r===(a=C).nodeType!==a.nodeType||a.textContent!==d.textContent)&&c(C,N)&&(l=l.concat(U(C,N)[0]).concat(I(N,C)));else{var b=m(N);if(f(C)){var x=v.get(N);if(!x){var w=(x=new t).startNode;b(x.extractContents()),v.set(w,x)}var T=C(x);T&&l.push(T),x.update(),g+=x.childNodes.length+1;continue}switch(C.nodeType){case r:b(document.createTextNode(C.textContent));break;case o:b(document.createComment(C.textContent));break;case n:var j=C.namespaceURI,A=C.tagName.toLowerCase(),E=j===i?document.createElement(A):document.createElementNS(j,A);l=l.concat(U(C,E)[0]).concat(I(E,C)),b(E)}}else u.removeChild(N),y--}var D=[];return[function e(t){return l.forEach(function(e){return e(t,D)}),D=t,e},function(){return s.useDocFragment?u.appendChild(h):void 0}]}e.NodesRange=t,e.emptyNode=a,e.render=F,e.morph=U,e.html=function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!r.length)return this;var o,i=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(r.join(g+C)),u=p[i],a=void 0;if(d(u))a=u;else{var c=S(r);o=c.replace(b,"<$1"+N+"$2"),a=R(y.parseFromString(o,"text/html").body),p[i]=a}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createDocumentFragment(),n=arguments[1];if(n&&n.templateId===i)return n(t);var r=U(a,e,{useDocFragment:!0}),o=h(r,2),u=o[0],c=o[1];return u(t),c(),u.templateId=i,u}},e.stopNode=function(){},Object.defineProperty(e,"__esModule",{value:!0})});
