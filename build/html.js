!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.MHTML={})}(this,function(e){"use strict";function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createTextNode(""),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.createTextNode("");return this.childNodes=[],this.firstChild=null,this.lastChild=null,this.startNode=e,this.stopNode=t,e&&t?e.parentNode!==t.parentNode?this:(this.update(),this):this}t.prototype.appendChild=function(e){this.stopNode.parentNode.insertBefore(e,this.stopNode),this.update()},t.prototype.removeChild=function(e){this.stopNode.parentNode.removeChild(e),this.update()},t.prototype.replaceChild=function(e,t){t.parentNode.replaceChild(e,t),this.update()},t.prototype.extractContents=function(){var e=document.createDocumentFragment();return e.appendChild(this.startNode),this.childNodes.reduce(function(e,t){return e.appendChild(t),e},e),e.appendChild(this.stopNode),e},t.prototype.update=function(){this.childNodes=[];for(var e=this.startNode.nextSibling;e&&e!==this.stopNode;e=e.nextSibling)this.childNodes.push(e);this.firstChild=this.childNodes[0],this.lastChild=this.childNodes[this.childNodes.length-1]};var n,r=1,o=3,i=8,a=document.body.namespaceURI,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function c(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function s(e,t){return e.nodeType===t.nodeType&&(e.tagName&&t.tagName&&e.tagName.toLowerCase()===t.tagName.toLowerCase())}function d(e){return void 0!==e}function f(e){return!!e&&("object"===(void 0===e?"undefined":u(e))||l(e))&&l(e.then)}function l(e){return"function"==typeof e}function p(e){return e&&"object"===(void 0===e?"undefined":u(e))&&e.constructor===Object}function h(e){return(void 0===e?"undefined":u(e))===u(!0)}function m(e){return e.replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g,"\\$&")}function v(){}var y=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N={},C=new Map,b=new Map,x=new DOMParser,w="{modulor_html_chunk_"+ +new Date+":",D="}",T=/<([/]?)([^ />]+)((?:\s+[\w}{:-]+(?:([\s])*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)[ ]*>/gim,j=/([-A-Za-z0-9_}{:]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/gim,A=["table","tr","td","style"],O="modulor-dynamic-tag-"+ +new Date,k="modulor-chunk-"+ +new Date,S="modulor-data-attributes-"+ +new Date,E=new RegExp(G(),"i"),F=new RegExp(G(!0),"ig"),I=new RegExp("^"+G(!0)+"$"),R="preventChildRendering",L="function",M="array",U="element",$="promise",_="undefined",P="text";function V(e){return l(e)?L:e instanceof Array?M:e instanceof Node?U:f(e)?$:d(e)?P:_}function J(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];return n?t[n[2]]:e.replace(F,function(e,n,r){var o=t[r];return d(o)?o:""})}function z(e,t){var n=t.name,r=t.value;if(f(r))r.then(function(t){return z(e,{name:n,value:t})});else if("style"!==n)if(l(n))n(e,r);else{if(n in e){h(e[n])&&!1!==r&&e.setAttribute(n,r);try{return void(e[n]=r)}catch(e){}}e.setAttribute(n,r)}else p(r)?Object.assign(e.style,r):e.setAttribute(n,r)}function B(e,t){if(d(e)&&""!==e){var n=V(e);return n===$?e.then(function(e){return B(e,t)}):(n===M?e:(""+e).split(" ")).forEach(function(e){return t(e)})}}function H(e,t){var n=new Map;return[function(e,t){n.set(e,{value:t,updated:(n.get(e)||{}).value!==t,keep:!0})},function(){var r={},o=!1;return n.forEach(function(i,a){var u=i.updated,c=i.value;if(!i.keep)return n.delete(a),o=!0,t(a,c);u&&(o=!0,e(a,c)),"string"==typeof a&&(r[a]=c),n.set(a,{value:c,keep:!1})}),[o,r]}]}function Z(e){var t={nodeType:e.nodeType,namespaceURI:e.namespaceURI,textContent:e.textContent,attributes:[],childNodes:[]},n=t.childNodes,r=e.getAttribute(S),a=E.exec(r),u=r?JSON.parse(r).map(function(e){var t=e.name,n=e.value,r=void 0===n||n;return{name:t,value:r,matchName:I.exec(t),matchValue:I.exec(r),nameIsDynamic:E.test(t),valueIsDynamic:E.test(r)}}):[];t.attributes=a?[function(e){var t=H(function(t,n){return z(e,{name:t,value:n})},function(t){e.removeAttribute(t),h(e[t])&&(e[t]=!1)}),n=y(t,2),r=n[0],o=n[1],i=H(function(t){return B(t,function(t){return e.classList.add(t)})},function(t){return B(t,function(t){return e.classList.remove(t)})}),a=y(i,2),c=a[0],s=a[1];return function(t){var n={},i=!1;for(var a in u){var d=u[a],f=d.name,l=d.value,h=d.matchName,m=d.matchValue,v=d.nameIsDynamic,g=d.valueIsDynamic,N=v?J(f,t,h):f;if("class"!==N){var C=g?J(l,t,m):l;if(N)if(p(N))for(var b in N)r(b,N[b]);else r(N,C)}else{var x=l.split(" ");for(var w in x){var D=x[w],T=J(D,t,D.match(I));T&&c(T,!0)}var j=s(),A=y(j,1)[0];i=i||A,n.className=e.className}}var O=o(),k=y(O,2),S=k[0],E=k[1];return[Object.assign(n,E),i||S]}}]:u;for(var c=e.childNodes||[],s=function(e){var t=c[e];return t.nodeType===o?(t.textContent.split(E).forEach(function(e){if(e){var t=I.exec(e);n.push(t?function(e){return function(n){return K(n[t[2]],e)}}:{nodeType:o,textContent:e})}}),"continue"):t.nodeType===i?(n.push(t.textContent.match(E)?function(e){var n=document.createComment(""),r=t.textContent;return e.appendChild(n),function(e){n.textContent=J(r,e)}}:{nodeType:i,textContent:t.textContent}),"continue"):void n.push(Z(t))},d=0;d<c.length;d++)s(d);var f=e.tagName;if(f===O.toUpperCase()){var l=e.attributes[k].value,m=l.match(I);if(l.match(E))return function(e){var n=void 0;return function(r,o){var i=J(l,r,m),a=J(l,o,m);if(n&&i===a)return n(r);var u,c,s,d=V(i),f={childNodes:[Object.assign({},t,{tagName:i})]};if(d===L){var p=X(f,{appendChild:v,replaceChild:v,childNodes:[(u={props:function(t){return K(i(t),e)}},c={},s=Object.assign(g({props:v,tagName:null,setAttribute:function(e,t){"class"===e&&(c=t.split(" ").reduce(function(e,t){return Object.assign(e,g({},t,!0))},{}))},removeAttribute:v,classList:{add:function(e){c[e]=!0,s.className=Object.keys(c).join(" ").trim()},remove:function(e){delete c[e],s.className=Object.keys(c).join(" ").trim()}},className:"",attributes:[],childNodes:[],appendChild:v,isVirtual:!0},R,!0),u),s)]}),h=y(p,1);return(n=h[0])(r)}var N=X(f,e,{useDocFragment:!0}),C=y(N,2),b=C[0],x=C[1];b(r),x(),n=b}};t.tagName=l.toUpperCase()}else f&&(t.tagName=e.tagName.toUpperCase());return t}function q(e){var t,n=(t=e,Array.isArray(t)?t:Array.from(t)),r=n[0];return n.slice(1).reduce(function(e,t,n){var r=""+w+n+D;return e.concat(r).concat(t)},r)}function G(e){var t=(e?"(":"")+"\\d+"+(e?")":"");return"("+m(w)+t+m(D)+")"}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.createDocumentFragment(),n=C.get(t)||{},r=V(e),o=n.lastChunk,i=n.lastRenderedChunkType,a=n.update;if(o===e)return t;if(r===$)return Q[$](t,e),t;if(i!==r)c(t);else if(a){var u=a(e);return l(u)&&(n.update=u),n.lastChunk=e,t}return C.set(t,{update:Q[r](t,e),lastRenderedChunkType:r,lastChunk:e}),t}var Q=(g(n={},M,function e(t,n){var r=X({childNodes:[].concat(n).map(function(e,t){return function(e){return function(n){return K(n[t],e)}}})},t,{useDocFragment:!0}),o=y(r,2),i=o[0],a=o[1];return i(n),a(),function(r){if(r.length!==n.length)return e(t,r);i(r)}}),g(n,_,c),g(n,P,function(e,t){var n=document.createTextNode(t);return e.appendChild(n),function(e){return n.textContent=e}}),g(n,U,function(e,t){return e.appendChild(t),function(t){e.childNodes.length>1&&e.childNodes.slice(1).forEach(function(t){return e.removeChild(t)}),e.replaceChild(t,e.childNodes[0])}}),g(n,$,function(e,t){t.then(function(t){e.update(),K(t,e)})}),g(n,L,function(e,t){var n=t(e);return function(t){n=t(e,n)}}),n);function W(e,t,n){for(var r=t.attributes,o=e.attributes,i=0;i<o.length;i++)e.removeAttribute(o[i].name);for(var a=[],u={},c=0;c<r.length;c++){var s=r[c];if(l(s))a.push(s(e));else{var d=s.name,f=s.value;z(e,{name:d,value:f}),u["class"===d?"className":d]=f}}if(e[R]&&a.push(function(e){return[{children:function(n,r){if(r)return r(e),r;var o=X(t,n,{useDocFragment:!0}),i=y(o,2),a=i[0],u=i[1];return a(e),u(),a}},!0]}),"props"in e){var p=l(e.props)?e.props:function(t,n){return n&&(e.props=t)};if(a.length)return[function(e,t){var n=a.reduce(function(n,r){var o=y(n,2),i=o[0],a=o[1],u=r(e,t),c=y(u,2),s=c[0],d=c[1];return[Object.assign({},i,s),a||d]},[u,!1]),r=y(n,2),o=r[0],i=r[1];p(o,i)}];p(u,!0)}return a}function X(e,n){var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n[R])return[v,[]];for(var c,d,f=[],p=u.useDocFragment?document.createDocumentFragment():n,h=e.childNodes,m=function(e){return e?function(t){return n.replaceChild(t,e)}:function(e){return p.appendChild(e)}},y=0,g=0;;y++){var N=h[y],C=n.childNodes[y+g];if(!N&&!C)break;if(N)if(C&&s(N,C))d=C,(o===(c=N).nodeType!==c.nodeType||c.textContent!==d.textContent)&&s(N,C)&&(f=f.concat(X(N,C)[0]).concat(W(C,N)));else{var x=m(C);if(l(N)){var w=b.get(C);if(!w){var D=(w=new t).startNode;x(w.extractContents()),b.set(D,w)}var T=N(w);T&&f.push(T),w.update(),g+=w.childNodes.length+1;continue}switch(N.nodeType){case o:x(document.createTextNode(N.textContent));break;case i:x(document.createComment(N.textContent));break;case r:var j=N.namespaceURI,A=N.tagName,O=void 0;O=C&&C[R]?C:j===a?document.createElement(A.toLowerCase()):document.createElementNS(j,A.toLowerCase()),f=f.concat(X(N,O)[0]).concat(W(O,N)),x(O)}}else n.removeChild(C),y--}var k=[];return[function e(t){return f.forEach(function(e){return e(t,k)}),k=t,e},function(){return u.useDocFragment?n.appendChild(p):void 0}]}e.NodesRange=t,e.emptyNode=c,e.render=K,e.morph=X,e.html=function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!r.length)return this;var o,i=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(r.join(w+D)),a=N[i],u=void 0;if(d(a))u=a;else{var c=q(r);o=c.replace(T,function(e,t,n,r,o,i){var a=(r=r.replace(/\/$/,function(){return i="/",""})).match(j);return r=a&&"!--"!==n?" "+S+"='"+JSON.stringify(a.reduce(function(e,t){var n=t.split("="),r=y(n,2),o=r[0],i=r[1];return e.concat({name:o,value:i?i.replace(/^['"]([^'"]*)['"]$/,"$1"):void 0})},[]))+"'":r,(~A.indexOf(n)||n.match(E))&&(r=" "+k+'="'+n.trim()+'"'+r,n=O),i?"<"+n+r+"></"+n+">":t?"</"+n+">":"<"+t+n+r+">"}),u=Z(x.parseFromString(o,"text/html").body),N[i]=u}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createDocumentFragment(),n=arguments[1];if(n&&n.templateId===i)return n(t);var r=X(u,e,{useDocFragment:!0}),o=y(r,2),a=o[0],c=o[1];return a(t),c(),a.templateId=i,a}},e.stopNode=function(){},Object.defineProperty(e,"__esModule",{value:!0})});
