!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.MHTML={})}(this,function(t){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createTextNode(""),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.createTextNode("");return this.childNodes=[],this.firstChild=null,this.lastChild=null,this.startNode=t,this.stopNode=e,t&&e?t.parentNode!==e.parentNode?this:(this.update(),this):this}e.prototype.appendChild=function(t){this.stopNode.parentNode.insertBefore(t,this.stopNode),this.update()},e.prototype.removeChild=function(t){this.stopNode.parentNode.removeChild(t),this.update()},e.prototype.replaceChild=function(t,e){e.parentNode.replaceChild(t,e),this.update()},e.prototype.extractContents=function(){var t=document.createDocumentFragment();return t.appendChild(this.startNode),this.childNodes.reduce(function(t,e){return t.appendChild(e),t},t),t.appendChild(this.stopNode),t},e.prototype.update=function(){var t=this;this.childNodes=[];for(var e=this.startNode.nextSibling;e&&e!==this.stopNode;e=e.nextSibling)e.range&&(e.range.onUpdate=function(){return t.update()}),this.childNodes.push(e);this.firstChild=this.childNodes[0],this.lastChild=this.childNodes[this.childNodes.length-1],this.onUpdate&&this.onUpdate()},e.prototype.getByIndex=function(t){};var n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var o={},i={FUNCTION_NODE:-1,ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};function u(t){for(var e=t.childNodes,n=0;n<e.length;n++)t.removeChild(e[n])}function a(t,e){return t.nodeType===e.nodeType&&(t.tagName&&e.tagName&&t.tagName.toLowerCase()===e.tagName.toLowerCase())}function c(t){return void 0!==t}function d(t){return"function"==typeof t}function s(t){return t.replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g,"\\$&")}function f(t){return d(t)?"function":t instanceof Array?"array":t instanceof Node?"element":!(e=t)||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e||"function"!=typeof e.then?c(t)?"text":"undefined":"futureResult";var e}function l(t,e,n){""!==n&&"style"!==e&&e in t?t[e]=n:t.setAttribute(e,n)}var h="{modulor_html_chunk_"+ +new Date+":",p="}",N=new DOMParser,m="modulor_sanitize_node_"+ +new Date+":",v=new RegExp("<([ /])?("+["table","tr","td"].join("|")+")([ ][^]>)?","igm");function C(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.PREFIX||h,C=t.POSTFIX||p,E=t.parser||N,y=new RegExp(A(),"ig"),g=new RegExp(A(),"ig"),T=new RegExp(A(!0),"ig"),O=new RegExp("^"+A(!0)+"$"),D=t.SANITIZE_NODE_PREFIX||m;function _(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[])[t]}function x(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.replace(T,function(t,n,r){var o=_(r,e);return c(o)?o:""})}function b(t){var e={nodeType:t.nodeType,textContent:t.textContent,attributes:[],childNodes:[]};t.tagName&&(e.tagName=t.tagName.toLowerCase().replace(D,"").toUpperCase());for(var n=t.attributes||[],r=function(t){var r=n[t],o=r.name,i=r.value,u=o.match(g),a=i.match(g),c=o.match(O),d=i.match(O);u||a?e.attributes.push(function(t){return"class"===o?(t.className="",i.split(" ").reduce(function(e,n){return n.match(g)?e.concat(function(e,r){var o=x(n,e),i=x(n,r);i!==o&&(i&&t.classList.remove(i),o&&t.classList.add(o))}):(t.classList.add(n),e)},[])):[function(e,n){var r=c?_(c[2],e):x(o,e),u=c?_(c[2],n):x(o,n),a=d?_(d[2],e):x(i,e),s=d?_(d[2],n):x(i,n);r===u&&a===s||(r!==u&&t.removeAttribute(u),r&&("function"!==f(r)?"futureResult"!==f(a)?l(t,r,a):a.then(function(e){return l(t,r,e)}):r(t,a)))}]}):e.attributes.push({name:o,value:i})},o=0;o<n.length;o++)r(o);for(var u=t.childNodes||[],a=function(t){var n=u[t];return n.nodeType===i.TEXT_NODE?(n.textContent.split(y).filter(function(t){return!!t}).forEach(function(t){var n=t.match(O);if(n){var r=n[2];e.childNodes.push(function(t){return function(e){return F(_(r,e),t)}})}else e.childNodes.push({nodeType:i.TEXT_NODE,textContent:t})}),"continue"):n.nodeType===i.COMMENT_NODE&&n.textContent.match(g)?(e.childNodes.push(function(t){var e=document.createComment(""),r=n.textContent;return t.appendChild(e),function(t){e.textContent=x(r,t)}}),"continue"):void e.childNodes.push(b(n))},c=0;c<u.length;c++)a(c);return e}function R(t){return b(E.parseFromString(t,"text/html").body)}function w(t){var e,n=(e=t,Array.isArray(e)?e:Array.from(e)),o=n[0];return n.slice(1).reduce(function(t,e,n){var o=function(t){return""+r+t+C}(n);return t.concat(o).concat(e)},o)}function A(t){var e=(t?"(":"")+"\\d+"+(t?")":"");return"("+s(r)+e+s(C)+")"}function I(t){return t.replace(v,"<$1"+D+"$2")}var M=new Map,S=new Map;function F(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f(t),r=M.get(e)||{},o=r.lastChunk,i=r.lastRenderedChunkType,a=r.update;if(o===t)return e;if("futureResult"===n)return k.futureResult(e,t),e;if(i!==n)u(e);else if(a){var c=a(t);return d(c)&&(r.update=c),r.lastChunk=t,e}return M.set(e,{update:k[n](e,t),lastRenderedChunkType:n,lastChunk:t}),e}var k={array:function(t,e){var r=U({childNodes:[].concat(e).map(function(t,e){return function(t){return function(n){return F(n[e],t)}}})},t,{useDocFragment:!0}),o=n(r,2),i=o[0],u=o[1];return i(e),u(),function(n){if(n.length!==e.length)return k.array(t,n);i(n)}},undefined:u,text:function(t,e){var n=document.createTextNode(e);return t.appendChild(n),function(t){return n.textContent=t}},element:function(t,e){return t.appendChild(e),function(e){t.childNodes.length>1&&t.childNodes.slice(1).forEach(function(e){return t.removeChild(e)}),t.replaceChild(e,t.childNodes[0])}},futureResult:function(t,e){e.then(function(e){t.update(),F(e,t)})},function:function(t,e){var n=e(t);return function(e){n=e(t,n)}}};function L(t,e){for(var n=e.attributes,r=t.attributes,o=0;o<r.length;o++)t.removeAttribute(r[o].name);for(var i=[],u=0;u<n.length;u++){var a=n[u];if(d(a))i=i.concat(a(t));else l(t,a.name,a.value)}return i}function U(t,n){for(var r,o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=[],s=u.useDocFragment?document.createDocumentFragment():n,f=t.childNodes,l=function(t){return t?function(e){return n.replaceChild(e,t)}:function(t){return s.appendChild(t)}},h=0,p=0;;h++){var N=f[h],m=n.childNodes[h+p];if(!N&&!m)break;if(N)if(m&&a(N,m))r=N,o=m,(i.TEXT_NODE===r.nodeType!==r.nodeType||r.textContent!==o.textContent)&&a(N,m)&&(c=c.concat(U(N,m)[0]).concat(L(m,N)));else{var v=l(m);if(d(N)){var C=S.get(m);if(!C){var E=(C=new e).startNode;v(C.extractContents()),S.set(E,C)}var y=N(C);y&&c.push(y),C.update(),p+=C.childNodes.length+1;continue}switch(N.nodeType){case i.COMMENT_NODE:var g=document.createComment("");N.textContent;v(g);break;case i.ELEMENT_NODE:var T=document.createElement(N.tagName.toLowerCase());c=c.concat(U(N,T)[0]).concat(L(T,N)),v(T);break;case i.TEXT_NODE:v(document.createTextNode(N.textContent))}}else n.removeChild(m),h--}var O=[];return[function t(e){return c.forEach(function(t){return t(e,O)}),O=e,t},function(){return u.useDocFragment?n.appendChild(s):void 0}]}return{html:function(){for(var t=arguments.length,e=Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!u.length)return this;var a=function(t){for(var e=5381,n=t.length;n;)e=33*e^t.charCodeAt(--n);return e>>>0}(u.join(r+C)),d=o[a],s=void 0;if(c(d))s=d;else{var f=w(u);s=R(I(f)),o[a]=s}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createDocumentFragment(),r=arguments[1];if(r&&r.templateId===a)return r(e);var o=U(s,t,{useDocFragment:!0}),i=n(o,2),u=i[0],c=i[1];return u(e),c(),u.templateId=a,u}},render:function(t){return F(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.createDocumentFragment(),"function")},renderChunk:F,prepareLiterals:w,generateContainer:R,sanitize:I,replaceTokens:x,copyAttributes:L,morph:U,processNode:b}}var E=C({}),y=E.html,g=E.render,T=E.renderChunk;t.stopNode=function(){},t.createHtml=C,t.html=y,t.render=g,t.renderChunk=T,t.r=function(){return g(y.apply(void 0,arguments))},t.until=function(t,e){return function(n){T(e,n),T(t,n)}},Object.defineProperty(t,"__esModule",{value:!0})});
